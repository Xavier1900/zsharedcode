#summary JQueryElement 进度条 - 计时器
#labels Phase-Implementation
<font face="microsoft yahei">
=== 说明 ===
 这是一个简单的计时器, 在输入了计时秒数并点击计时开始按钮后, 进度条 [JQueryUIProgressbar Progressbar] 控件将显示时间进度, 在计时完成后, 将通过 Ajax 和服务器通信并返回消息.

 ==== 设置进度条当前值 ====
 通过 [JQueryUIProgressbar Progressbar] 的 Value 属性设置其当前值, 比如: {{{<je:Progressbar ID="bar" runat="server" Value="0" ...></je:Progressbar>}}}, 这里设置当前值为 0, 其实可以不设置, 因为默认为 0.

 ==== 设置进度条完成时的 Ajax 操作 ====
 下面是进度条的 Ajax 设置代码:
{{{
<je:Progressbar ID="bar" runat="server" ...>
	<CompleteAsync Success="
	function(data) {
		$('#lblMessage').html(data.result);
	}
	" Url="progressbar.ashx">
	</CompleteAsync>
</je:Progressbar>
}}}
 我们通过设置 CompleteAsync, 调用了 progressbar.ashx, 而 progressbar.ashx 返回了 json 格式的数据. Ajax 设置格式如下:
{{{
<CompleteAsync Success="
<Ajax 调用成功处理的 javascript 函数>
" Url="<Ajax 所调用的地址>">
</CompleteAsync>
}}}
 Ajax 更多的设置这里不再讲述. 此外, 你还可以通过设置 Change, Complete, ChangeSync, CompleteSync 来设置改变和完成的客户端/服务器端事件.
 
 ==== 生成 javascript 变量 ====
 可以设置 [JQueryUIButton Button] 的 IsVariable 属性为 True, 比如: {{{<je:Progressbar ID="bar" runat="server" ... IsVariable="true" ...></je:Progressbar>}}}, 将根据 ClientID 来生成同名的 javascript 变量来表示进度条. 之后可以使用内嵌语法 {{{eval('[%id:bar%]').progressbar('option', 'value', 100 - ((second * 100) / totalSecond));}}} 来访问此进度条.

 ==== 参考图片 ====
 [http://zsharedcode.googlecode.com/files/progressbar.design.png]
 [http://zsharedcode.googlecode.com/files/progressbar.runtime.png]

=== progressbar/Default.aspx ===
{{{
<%@ Page Language="C#" %>

<%@ Register Namespace="zoyobar.shared.panzer.ui.jqueryui" TagPrefix="je" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
	<title>JQueryElement 进度条 - 计时器</title>
	<link rel="stylesheet" href="../css/ui-lightness/jquery-ui-1.8.11.custom.css" />
	<script type="text/javascript" src="../js/jquery-1.5.1.min.js"></script>
	<script type="text/javascript" src="../js/jquery-ui-1.8.11.custom.min.js"></script>
</head>
<body>
	<form id="formJE" runat="server">
	<je:JQueryScript ID="script" runat="server">
		<Html>
		<script type="text/javascript">
			var totalSecond;

			function wait(second) {

				if (second < 0)
					return;

				eval('[%id:bar%]').progressbar('option', 'value', 100 - ((second * 100) / totalSecond));
				eval('[%id:cmd%]').button('option', 'label', second + ' 秒');
				setTimeout("wait(" + (second - 1) + ")", 1000);
			}

			function start() {
				totalSecond = new Number($('#txtSecond').val());

				if (totalSecond <= 0 || isNaN(totalSecond)) {
					$('#lblMessage').html('输入的秒数错误').css('color', '#ff0000');
					return;
				}

				wait(totalSecond);
			}
		</script>
		</Html>
	</je:JQueryScript>
	<je:Progressbar ID="bar" runat="server" Value="0" IsVariable="true" Width="300px">
		<CompleteAsync Success="
		function(data) {
			$('#lblMessage').html(data.result);
		}
		" Url="progressbar.ashx">
		</CompleteAsync>
	</je:Progressbar>
	秒数: <input id="txtSecond" type="text" value="10" class="ui-widget" />&nbsp;
	<je:Button ID="cmd" runat="server" Label="计时开始" Click="start" IsVariable="True"></je:Button>
	<p id="lblMessage"></p>
	<p style="font-size: smaller; text-align: right;">
		版本 2.6, 讨论, 获取 JQueryElement 最新消息, 请加 QQ 群: 149829251 (JQueryElement 编程).</p>
	<p style="font-size: smaller; text-align: right;">
		<a href="http://code.google.com/p/zsharedcode/wiki/JQueryElementProgressBarDoc">代码解释说明</a>
		<a href="http://code.google.com/p/zsharedcode/wiki/JQueryElement">JQueryElement (JE) 成员参考</a><br />
		JE 是 panzer 项目的一部分, 您可以参考 <a href="http://code.google.com/p/zsharedcode/">http://code.google.com/p/zsharedcode/</a>.<br />
		所有示例源码托管地址: <a href="http://panzer.codeplex.com/">http://panzer.codeplex.com/</a>.
	</p>
	</form>
</body>
</html>
}}}

=== progressbar/progressbar.aspx ===
{{{
<%@ WebHandler Language="C#" Class="progressbar" %>

using System;
using System.Web;

public class progressbar : IHttpHandler
{

	public void ProcessRequest ( HttpContext context )
	{
		context.Response.ContentType = "text/javascript";
		context.Response.Cache.SetNoStore ( );
		
		context.Response.Write ( "{\"result\": \"这里是从服务器返回的消息: 计时已经完成\"}" );
	}

	public bool IsReusable
	{
		get { return false; }
	}

}
}}}

=== 前提条件 ===
 所有示例代码可以在 http://panzer.codeplex.com/releases/view/61701#DownloadId=212072 下载. 页面需要添加 [http://jqueryui.com/ jQuery UI] 的脚本和样式.

*注意:* 这里仅列出部分代码, 可能需要您自己创建窗口, 页面等.
</font>